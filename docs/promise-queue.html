<!DOCTYPE html>

<html>
<head>
  <title>promise-queue.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="behavior.html">
                behavior.js
              </a>
            
              
              <a class="source" href="byte-stream.html">
                byte-stream.js
              </a>
            
              
              <a class="source" href="clock.html">
                clock.js
              </a>
            
              
              <a class="source" href="iteration.html">
                iteration.js
              </a>
            
              
              <a class="source" href="observable.html">
                observable.js
              </a>
            
              
              <a class="source" href="operators.html">
                operators.js
              </a>
            
              
              <a class="source" href="promise-queue.html">
                promise-queue.js
              </a>
            
              
              <a class="source" href="promise.html">
                promise.js
              </a>
            
              
              <a class="source" href="stream.html">
                stream.js
              </a>
            
              
              <a class="source" href="task.html">
                task.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>promise-queue.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>A promise queue is an asynchronous linked list, representing a sequence of
values over time.
Consuming and producing that sequence are temporaly independent.
For each respective promise and resolution, the promise may be gotten first
and put later, or put first and gotten later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">
"use strict"</span>;

<span class="hljs-keyword">var</span> Promise = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./promise"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="promisequeue">PromiseQueue</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The promise queue constructor returns an entangled <code>get</code> and <code>put</code> pair.
These methods may be passed as functions, granting either the capability to
give or take but not necessarily both.</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Internally, a promise queue is an asynchronous linked list of deferreds.
The <code>ends</code> variable is a <code>promise</code> and <code>resolver</code> pair.
The <code>promise</code> is a promise for the next <code>ends</code> pair after this promise is
taken.
The <code>resolver</code> advances the <code>ends</code> pair after a resolution is given.
The <code>promise</code> and <code>resolver</code> are independent properties, not necessarily
corresponding to the same deferred.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-built_in">module</span>.exports = PromiseQueue;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PromiseQueue</span><span class="hljs-params">(values)</span> </span>{
    <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> PromiseQueue)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PromiseQueue();
    }
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> ends = Promise.defer();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The <code>resolver</code> side of a promise queue adds a <code>{head, tail}</code> node to the
asynchronous linked list.
The <code>put</code> method creates a new link to the resolver side with the given
<code>head</code> value, and advances the <code>resolver</code> side of the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.put = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> </span>{
        <span class="hljs-keyword">var</span> next = Promise.defer();
        ends.resolver.return({
            head: value,
            tail: next.promise
        });
        ends.resolver = next.resolver;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The <code>promise</code> end of a promise queue is a promise for a <code>{head, tail}</code>
pair.
The <code>head</code> will be the next value, and the <code>tail</code> will be a promise for
the remaining nodes of the list.
The <code>get</code> method obtains and returns a promise for the <code>head</code> value and
advances the <code>promise</code> to become the <code>tail</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.get = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> result = ends.promise.get(<span class="hljs-string">"head"</span>);
        ends.promise = ends.promise.get(<span class="hljs-string">"tail"</span>);
        <span class="hljs-keyword">return</span> result;
    };

    <span class="hljs-keyword">if</span> (values) {
        values.forEach(<span class="hljs-keyword">this</span>.put, <span class="hljs-keyword">this</span>);
    }
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
